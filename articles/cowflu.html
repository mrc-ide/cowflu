<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Toy Example • cowflu</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Toy Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cowflu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/cowflu.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/cowflu/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Toy Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/cowflu/blob/main/vignettes/cowflu.Rmd" class="external-link"><code>vignettes/cowflu.Rmd</code></a></small>
      <div class="d-none name"><code>cowflu.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/cowflu">cowflu</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette walks through the basic use of the model for a toy
example.</p>
<p>Each model system is comprised of a number of regions, and each
region contains a unique number of herds.</p>
<p>Consider 3 regions, each containing 3, 7, and 11, herds
respectively.</p>
<p>##Setting model parameters</p>
<p>First, we set the model parameters:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_inputs</span><span class="op">(</span></span>
<span>  alpha <span class="op">=</span> <span class="fl">0.2</span>, <span class="co">#The rate of herd-to-herd infection contacts within each region.</span></span>
<span>  beta <span class="op">=</span> <span class="fl">0.9</span>,  <span class="co">#The transmission rate</span></span>
<span>  gamma <span class="op">=</span> <span class="fl">0.7</span>, <span class="co">#The incubation rate</span></span>
<span>  sigma <span class="op">=</span> <span class="fl">0.9</span>,  <span class="co">#The recovery rate</span></span>
<span>  asc_rate <span class="op">=</span> <span class="fl">1</span>, <span class="co"># The ascertainment rate</span></span>
<span>  dispersion <span class="op">=</span> <span class="fl">1</span>, <span class="co"># Dispersion parameter, when fitting</span></span>
<span>  inputs <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_fixed_inputs</span><span class="op">(</span></span>
<span>    n_herds_per_region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">11</span><span class="op">)</span>,</span>
<span>    p_region_export <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.5</span>, <span class="fl">.5</span><span class="op">)</span>,</span>
<span>    p_cow_export <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>    n_cows_per_herd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">7</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3000</span>, <span class="fl">11</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    movement_matrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.6</span>, <span class="fl">.2</span>, <span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.6</span>, <span class="fl">.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    time_test <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>    start_herd <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    start_count <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><code>alpha</code>, <code>beta</code>, <code>gamma</code>, and
<code>sigma</code> are epidemiological parameters.
<code>n_herds_per_region</code> is a vector listing the number of herds
in each region. <code>p_region_export</code> is a vector listing the
probability that, each day, a herd within the respective region will
export cattle to another herd. This does not yet inform where that herd
will go, only whether or not an export is going to happen.
<code>p_cow_export</code> is a vector listing the probability that,
given a herd is exporting cattle, what is the probability that each cow
in that herd will be included in the export. i.e. our toy example states
that if a herd is exporting cattle, 20% of that herd will be exported on
average, in every region. <code>n_cows_per_herd</code> is a vector
listing exactly how many cows are in each herd of the model.
<code>movement_matrix</code> details the probability of which region an
exported herd will be sent to. Element <code>(i, j)</code> is the
probability that an export from region <code>i</code> will be sent to
region <code>j</code>. Thus, each row will sum to 1.
<code>time_test</code> is the time point (in days) at which cattle will
start being tested for flu. At this point, when a herd is exported from
one region to another, a number of cows (see <code>x</code> below) will
be sampled from the exported cows. If any of these sampled cows are in
the Infected compartment, the export is cancelled.
<code>start_herd</code> is the herd in which infected cows are seeded
into at model initialisation. <code>start_count</code> is the number of
infected cows to be seeded into herd <code>start_herd</code> at model
initialisation.</p>
<p>Other model parameters are: <code>n_test</code> is the number of cows
that are tested during inter-region exports from <code>time_test</code>
onwards. This defaults to 30.</p>
<div class="section level2">
<h2 id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a>
</h2>
<p>Start by setting the seed, and the number of particles we wish to
run</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">n_particles</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<p>Initialise the dust system:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_create.html" class="external-link">dust_system_create</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cows</span><span class="op">(</span><span class="op">)</span>, <span class="va">pars</span>, n_particles <span class="op">=</span> <span class="va">n_particles</span>, dt <span class="op">=</span> <span class="fl">0.25</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_set_state_initial.html" class="external-link">dust_system_set_state_initial</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></code></pre></div>
<p>Run the model for the desired number of time-steps, in this instance,
from 0 to 75:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_simulate.html" class="external-link">dust_system_simulate</a></span><span class="op">(</span><span class="va">sys</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">75</span><span class="op">)</span></span></code></pre></div>
<p>One of the model variables exported on the end of this <code>s</code>
object is not part of the SEIR dynamics. We want to chop it off for
now.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">end_of_core_states</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">end_of_core_states</span>,<span class="op">]</span></span></code></pre></div>
<p>Now re-arrange this output into an array:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fl">5</span>, <span class="va">n_particles</span>, <span class="fl">76</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Dim 1 is the herd, and note that we also export cumulative region
totals too on the end.</p>
<p>Dim 2 is the number of epi compartments: S, E, I, and R, and outbreak
recording.</p>
<p>Dim 3 is the number of particles run.</p>
<p>Dim 4 is time.</p>
<p>Note, for large models, we may not want (or be able) to export every
herd’s dynamic profile. Instead, we can ask dust2 to just return the
region totals like so:</p>
<p>Create <code>i</code>, a list of the region total indices.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">i</span>, <span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="st">"+"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And run the model, and allocate output into an array</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_create.html" class="external-link">dust_system_create</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cows</span><span class="op">(</span><span class="op">)</span>, <span class="va">pars</span>, n_particles <span class="op">=</span> <span class="va">n_particles</span>, dt <span class="op">=</span> <span class="fl">0.25</span>, seed <span class="op">=</span> <span class="fl">42</span><span class="op">)</span></span>
<span><span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_set_state_initial.html" class="external-link">dust_system_set_state_initial</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_simulate.html" class="external-link">dust_system_simulate</a></span><span class="op">(</span><span class="va">sys</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">75</span>, <span class="va">i</span><span class="op">)</span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fl">4</span>, <span class="va">n_particles</span>, <span class="fl">76</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>And check that these outputs are the same:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span><span class="va">s1</span><span class="op">[</span><span class="fl">22</span><span class="op">:</span><span class="fl">24</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, , , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span>, <span class="va">s2</span><span class="op">)</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Rawson, Rich FitzJohn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
