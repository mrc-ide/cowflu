<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3) Plotting model outputs • cowflu</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3) Plotting model outputs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">cowflu</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/cowflu.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/fitting-parameters.html">1) Model Fitting with cowflu</a></li>
    <li><a class="dropdown-item" href="../articles/plotting-model.html">3) Plotting model outputs</a></li>
    <li><a class="dropdown-item" href="../articles/simulating-model.html">2) Simulating the model with fit parameters</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/cowflu/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>3) Plotting model outputs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/cowflu/blob/main/vignettes/plotting-model.Rmd" class="external-link"><code>vignettes/plotting-model.Rmd</code></a></small>
      <div class="d-none name"><code>plotting-model.Rmd</code></div>
    </div>

    
    
<p>This vignette walks through using the model simulations generated in
the previous vignette - “2) Simulating the model with fit parameters”,
to plot the figures shown in the associated publication “A mathematical
model of H5N1 influenza transmission in US dairy cattle”.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/cowflu">cowflu</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mrc-ide/dust2" class="external-link">dust2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mrc-ide.github.io/monty" class="external-link">monty</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-the-model-simulations">Load the model simulations<a class="anchor" aria-label="anchor" href="#load-the-model-simulations"></a>
</h2>
<p>We load a set of model simulations from the previous vignette. Note,
the results plotted in the main manuscript are from a simulation of
20,000 iterations. For simplicity, those shown below use only 500
iterations.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Path to the .rds file</span></span>
<span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_sim_results.rds"</span>, package <span class="op">=</span> <span class="st">"cowflu"</span><span class="op">)</span></span>
<span><span class="co"># Load the .rds file</span></span>
<span><span class="va">Sim_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="figure-2">Figure 2<a class="anchor" aria-label="anchor" href="#figure-2"></a>
</h2>
<p>First we load the real world data that will appear in the figure.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load data:</span></span>
<span><span class="co">###################</span></span>
<span></span>
<span><span class="va">data_outbreaks</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">outbreaks_data</span><span class="op">$</span><span class="va">weekly_outbreaks_data</span></span>
<span><span class="va">data_outbreaks</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">process_data_outbreak</span><span class="op">(</span><span class="va">data_outbreaks</span><span class="op">)</span></span>
<span><span class="va">data_week</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_filter_data.html" class="external-link">dust_filter_data</a></span><span class="op">(</span><span class="va">data_outbreaks</span>, time <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">extended_outbreaks_data</span> <span class="op">&lt;-</span> <span class="va">data_week</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">outbreak_detected</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_week</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">extended_outbreaks_data</span> <span class="op">&lt;-</span> <span class="va">extended_outbreaks_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">extended_outbreaks_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"outbreak_detected"</span>, <span class="st">"US_state"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add number of herds per state:</span></span>
<span><span class="va">extended_outbreaks_data</span><span class="op">$</span><span class="va">total_herds</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">extended_outbreaks_data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">extended_outbreaks_data</span><span class="op">$</span><span class="va">total_herds</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span> <span class="op">==</span> <span class="va">extended_outbreaks_data</span><span class="op">$</span><span class="va">US_state</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="co">##########################################</span></span>
<span><span class="co">## And also extract the exact number of new outbreaks data</span></span>
<span><span class="va">new_outbreaks_data</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">process_data_incidence</span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">outbreaks_data</span><span class="op">$</span><span class="va">weekly_outbreaks_data</span><span class="op">)</span></span>
<span><span class="va">new_data_week</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_filter_data.html" class="external-link">dust_filter_data</a></span><span class="op">(</span><span class="va">new_outbreaks_data</span>, time <span class="op">=</span> <span class="st">"week"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_outbreaks_data</span> <span class="op">&lt;-</span> <span class="va">new_data_week</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">positive_tests</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">new_data_week</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_outbreaks_data</span> <span class="op">&lt;-</span> <span class="va">new_outbreaks_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">new_outbreaks_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"new_outbreaks"</span>, <span class="st">"US_state"</span><span class="op">)</span></span>
<span><span class="co">## Add number of herds per state:</span></span>
<span><span class="va">new_outbreaks_data</span><span class="op">$</span><span class="va">total_herds</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">new_outbreaks_data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">new_outbreaks_data</span><span class="op">$</span><span class="va">total_herds</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span> <span class="op">==</span> <span class="va">new_outbreaks_data</span><span class="op">$</span><span class="va">US_state</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##Stick the two together:</span></span>
<span><span class="va">new_outbreaks_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">new_outbreaks_data</span>,</span>
<span>                            <span class="va">extended_outbreaks_data</span>,</span>
<span>                            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"US_state"</span>, <span class="st">"total_herds"</span><span class="op">)</span>,</span>
<span>                            all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Next, we extract and rearrange the simulation outputs into a
dataframe. Specifically, three model outputs of interest:</p>
<ol style="list-style-type: lower-roman">
<li>Another for “true number of herds with infected cattle”</li>
<li>Another for “total number of declared outbreaks”</li>
<li>One for model fit to “time of first outbreak detection”</li>
</ol>
<p>First, number (i):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The number of US states</span></span>
<span><span class="va">n_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract the data across all chains and iterations</span></span>
<span><span class="va">I_data</span> <span class="op">&lt;-</span> <span class="va">Sim_results</span><span class="op">[</span>,<span class="fl">49</span><span class="op">:</span><span class="fl">96</span>,<span class="op">]</span></span>
<span><span class="va">n_timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I_data</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">sim_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="va">sim_samples</span></span>
<span></span>
<span><span class="co">## Initialize an empty list to store data frames for each state</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Loop over each state and calculate summary statistics</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_states</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Extract data for the current state</span></span>
<span>  <span class="va">state_data</span> <span class="op">&lt;-</span> <span class="va">I_data</span><span class="op">[</span>,<span class="va">state</span>, <span class="op">]</span></span>
<span>  <span class="co">## Calculate mean, lower, and upper CI across particles for each time point</span></span>
<span>  <span class="va">state_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">state_data</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mean_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">ci_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>    <span class="va">ci_high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean_val</span>, lower_ci <span class="op">=</span> <span class="va">ci_low</span>, upper_ci <span class="op">=</span> <span class="va">ci_high</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co">## Convert to a data frame</span></span>
<span>  <span class="va">state_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">state_summary</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## Add time and state information</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n_timepoints</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="va">state</span></span>
<span>  <span class="co">## Append to the list</span></span>
<span>  <span class="va">data_list</span><span class="op">[[</span><span class="va">state</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">state_df</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Combine all state data frames into one data frame</span></span>
<span><span class="va">result_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Rename columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">result_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_infected"</span>, <span class="st">"lower_ci_infected"</span>, <span class="st">"upper_ci_infected"</span>, <span class="st">"Time"</span>, <span class="st">"US_state"</span><span class="op">)</span></span>
<span><span class="co">## Add number of herds per state:</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">total_herds</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span><span class="op">[</span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span><span class="op">]</span></span>
<span><span class="co">## Replace the US_state numbers with actual names</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_states</span>, labels <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span><span class="op">)</span></span>
<span><span class="co">## Add a descriptor of what type of data this is:</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">Type</span> <span class="op">&lt;-</span> <span class="st">"True Outbreaks"</span></span>
<span></span>
<span><span class="co">#Sim_data will be our final data frame.</span></span>
<span><span class="va">Sim_data</span> <span class="op">&lt;-</span> <span class="va">result_df</span></span></code></pre></div>
<p>Now, repeat this process, to add (ii) to the data frame:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract the  data across all chains and iterations</span></span>
<span><span class="va">I_data</span> <span class="op">&lt;-</span> <span class="va">Sim_results</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">48</span>,<span class="op">]</span></span>
<span><span class="va">n_timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I_data</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="va">n_samples</span> <span class="op">&lt;-</span> <span class="va">sim_samples</span></span>
<span><span class="co">## Initialize an empty list to store data frames for each state</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Loop over each state and calculate summary statistics</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_states</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Extract data for the current state</span></span>
<span>  <span class="va">state_data</span> <span class="op">&lt;-</span> <span class="va">I_data</span><span class="op">[</span>,<span class="va">state</span>, <span class="op">]</span></span>
<span>  <span class="co">## Calculate mean, lower, and upper CI across particles for each time point</span></span>
<span>  <span class="va">state_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">state_data</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mean_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">ci_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>    <span class="va">ci_high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean_val</span>, lower_ci <span class="op">=</span> <span class="va">ci_low</span>, upper_ci <span class="op">=</span> <span class="va">ci_high</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co">## Convert to a data frame</span></span>
<span>  <span class="va">state_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">state_summary</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## Add time and state information</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n_timepoints</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="va">state</span></span>
<span>  <span class="co">## Append to the list</span></span>
<span>  <span class="va">data_list</span><span class="op">[[</span><span class="va">state</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">state_df</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Combine all state data frames into one data frame</span></span>
<span><span class="va">result_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Rename columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">result_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_infected"</span>, <span class="st">"lower_ci_infected"</span>, <span class="st">"upper_ci_infected"</span>, <span class="st">"Time"</span>, <span class="st">"US_state"</span><span class="op">)</span></span>
<span><span class="co">## Add number of herds per state:</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">total_herds</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span><span class="op">[</span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span><span class="op">]</span></span>
<span><span class="co">## Replace the US_state numbers with actual names</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_states</span>, labels <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span><span class="op">)</span></span>
<span><span class="co">## Add a descriptor of what type of data this is:</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">Type</span> <span class="op">&lt;-</span> <span class="st">"Declared Outbreaks"</span></span>
<span></span>
<span><span class="co">## Add this new data to the previously made dataframe</span></span>
<span><span class="va">Sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Sim_data</span>, <span class="va">result_df</span><span class="op">)</span></span></code></pre></div>
<p>And lastly for (iii):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## We will need to reorder the data into a data frame:</span></span>
<span><span class="va">real_outbreaks_data</span> <span class="op">&lt;-</span> <span class="va">data_week</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest_longer.html" class="external-link">unnest_longer</a></span><span class="op">(</span><span class="va">outbreak_detected</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data_week</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">real_outbreaks_data</span> <span class="op">&lt;-</span> <span class="va">real_outbreaks_data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">real_outbreaks_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"outbreak_detected"</span>, <span class="st">"US_state"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract the  data across all chains and iterations</span></span>
<span><span class="va">I_data</span> <span class="op">&lt;-</span> <span class="va">Sim_results</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">48</span>,<span class="op">]</span></span>
<span><span class="va">n_timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I_data</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Convert to the step function form:</span></span>
<span><span class="co">## Loop through each region and each step</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">place</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I_data</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>      <span class="co"># Loop over the regions</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">chain</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I_data</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">{</span>    <span class="co"># Loop over the iterations</span></span>
<span></span>
<span>    <span class="co">## Get the time series for this place and chain</span></span>
<span>    <span class="va">infections</span> <span class="op">&lt;-</span> <span class="va">I_data</span><span class="op">[</span><span class="va">chain</span>, <span class="va">place</span>, <span class="op">]</span></span>
<span></span>
<span>    <span class="co">## Find the first time where infections &gt; 0</span></span>
<span>    <span class="va">first_infection</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">infections</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">first_infection</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co">## From the first infection onwards, set the step function to 1</span></span>
<span>      <span class="va">I_data</span><span class="op">[</span><span class="va">chain</span>, <span class="va">place</span>, <span class="va">first_infection</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">I_data</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span>      <span class="co">## Prior to the first infection, set the values to 0</span></span>
<span>      <span class="va">I_data</span><span class="op">[</span><span class="va">chain</span>, <span class="va">place</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">first_infection</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co">## If there are no infections at all, set everything to 0</span></span>
<span>      <span class="va">I_data</span><span class="op">[</span><span class="va">chain</span>, <span class="va">place</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Initialize an empty list to store data frames for each state</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Loop over each state and calculate summary statistics</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">state</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_states</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Extract data for the current state</span></span>
<span>  <span class="va">state_data</span> <span class="op">&lt;-</span> <span class="va">I_data</span><span class="op">[</span>,<span class="va">state</span>, <span class="op">]</span></span>
<span>  <span class="co">## Calculate mean, lower, and upper CI across particles for each time point</span></span>
<span>  <span class="va">state_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">state_data</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mean_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">ci_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>    <span class="va">ci_high</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean_val</span>, lower_ci <span class="op">=</span> <span class="va">ci_low</span>, upper_ci <span class="op">=</span> <span class="va">ci_high</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="co">## Convert to a data frame</span></span>
<span>  <span class="va">state_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">state_summary</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## Add time and state information</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n_timepoints</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">state_df</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="va">state</span></span>
<span>  <span class="co">## Append to the list</span></span>
<span>  <span class="va">data_list</span><span class="op">[[</span><span class="va">state</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">state_df</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Combine all state data frames into one data frame</span></span>
<span><span class="va">result_df</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">data_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Rename columns</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">result_df</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean_infected"</span>, <span class="st">"lower_ci_infected"</span>, <span class="st">"upper_ci_infected"</span>, <span class="st">"Time"</span>, <span class="st">"US_state"</span><span class="op">)</span></span>
<span><span class="co">## Add number of herds per state:</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">total_herds</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span><span class="op">[</span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span><span class="op">]</span></span>
<span><span class="co">## Replace the US_state numbers with actual names</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">result_df</span><span class="op">$</span><span class="va">US_state</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_states</span>, labels <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span><span class="op">)</span></span>
<span><span class="co">## Add a descriptor of what type of data this is:</span></span>
<span><span class="va">result_df</span><span class="op">$</span><span class="va">Type</span> <span class="op">&lt;-</span> <span class="st">"First Outbreak"</span></span>
<span></span>
<span><span class="va">Sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Sim_data</span>, <span class="va">result_df</span><span class="op">)</span></span></code></pre></div>
<p>Before plotting, we do a little tidying up of the dataframe:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add week_beginning columns</span></span>
<span><span class="co"># Define the starting date</span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-12-18"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add the Week_Beginning column to the data frame</span></span>
<span><span class="va">Sim_data</span><span class="op">$</span><span class="va">Week_Beginning</span> <span class="op">&lt;-</span> <span class="va">start_date</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">weeks</a></span><span class="op">(</span><span class="va">Sim_data</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span></span>
<span><span class="va">new_outbreaks_data</span><span class="op">$</span><span class="va">Week_Beginning</span> <span class="op">&lt;-</span> <span class="va">start_date</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">weeks</a></span><span class="op">(</span><span class="va">new_outbreaks_data</span><span class="op">$</span><span class="va">Time</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Change capitalisation of States:</span></span>
<span><span class="co">## Custom function to capitalize the first letter of each word</span></span>
<span><span class="va">capitalize</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">text</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">text</span>, <span class="st">" "</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substring</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, USE.NAMES <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">paste</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Sim_data</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">Sim_data</span><span class="op">$</span><span class="va">US_state</span><span class="op">)</span></span>
<span><span class="va">Sim_data</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="fu">capitalize</span><span class="op">(</span><span class="va">Sim_data</span><span class="op">$</span><span class="va">US_state</span><span class="op">)</span></span>
<span><span class="va">new_outbreaks_data</span><span class="op">$</span><span class="va">US_state</span> <span class="op">&lt;-</span> <span class="fu">capitalize</span><span class="op">(</span><span class="va">new_outbreaks_data</span><span class="op">$</span><span class="va">US_state</span><span class="op">)</span></span></code></pre></div>
<p>And now we produce the plots using the <code>geofacet</code>
package.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hafen/geofacet" class="external-link">geofacet</a></span><span class="op">)</span></span>
<span><span class="va">continental_us_grid1</span> <span class="op">&lt;-</span> <span class="va">us_state_grid1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">11</span>, <span class="op">-</span><span class="fl">51</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">continental_us_grid2</span> <span class="op">&lt;-</span> <span class="va">us_state_grid2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">11</span>, <span class="op">-</span><span class="fl">51</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">## i) The "fit to data" plot.</span></span>
<span><span class="co">#############################</span></span>
<span><span class="va">plot_sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Sim_data</span>, <span class="va">Type</span> <span class="op">==</span> <span class="st">"First Outbreak"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create the plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_sim_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Week_Beginning</span>, y <span class="op">=</span> <span class="va">mean_infected</span>, color <span class="op">=</span> <span class="st">"Model simulation"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Week_Beginning</span>, ymin <span class="op">=</span> <span class="va">lower_ci_infected</span>, ymax <span class="op">=</span> <span class="va">upper_ci_infected</span>,</span>
<span>                  fill <span class="op">=</span> <span class="st">"Model simulation"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_outbreaks_data</span>,</span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Week_Beginning</span>, y <span class="op">=</span> <span class="va">outbreak_detected</span>, color <span class="op">=</span> <span class="st">"Real data"</span>, fill <span class="op">=</span> <span class="st">"Real data"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Week Beginning"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"First Outbreak Detected"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Time of First Outbreak Detection"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Legend"</span>, <span class="co"># Legend title for line and points</span></span>
<span>       fill <span class="op">=</span> <span class="st">"Legend"</span> <span class="op">)</span> <span class="op">+</span>       <span class="co"># Exclude a separate legend title for the ribbon</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,    <span class="co"># Title text size</span></span>
<span>        axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="co"># X-axis label size</span></span>
<span>        axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, <span class="co"># Y-axis label size</span></span>
<span>        axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,  <span class="co"># X-axis tick label size</span></span>
<span>        axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,</span>
<span>        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">24</span><span class="op">)</span>,</span>
<span>        legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">1.5</span>, <span class="st">"lines"</span><span class="op">)</span>,</span>
<span>        legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="co"># Adjust to place legend inside the plot area</span></span>
<span>        legend.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="co"># Optional border for clarity</span></span>
<span>  <span class="op">)</span> <span class="op">+</span>   <span class="co"># Y-axis tick label size</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/geofacet/man/facet_geo.html" class="external-link">facet_geo</a></span><span class="op">(</span><span class="op">~</span> <span class="va">US_state</span>, grid <span class="op">=</span> <span class="va">continental_us_grid1</span>, label <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span></span>
<span>    date_labels <span class="op">=</span> <span class="st">"%b %y"</span>, <span class="co"># Only show abbreviated month names</span></span>
<span>    date_breaks <span class="op">=</span> <span class="st">"2 month"</span> <span class="co"># Ensure monthly ticks</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Model simulation"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"Real data"</span> <span class="op">=</span> <span class="st">"firebrick"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Set colors manually</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Model simulation"</span> <span class="op">=</span> <span class="st">"black"</span>, <span class="st">"Real data"</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Set fill color to match the line color</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span></span>
<span>    color <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,  <span class="co"># Increase point size in the legend</span></span>
<span>    fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span>    <span class="co"># Increase ribbon fill size in the legend</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">60</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2</span></span>
<span><span class="co">#&gt; 3.5.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use the `legend.position.inside` argument of `theme()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: Duplicated `override.aes` is ignored.</span></span></code></pre></div>
<p><img src="plotting-model_files/figure-html/unnamed-chunk-8-1.png" width="750">
The other model outputs can be produced in the same way, just editing
the above code to filter for the specific <code>Type</code> in the
dataframe.</p>
</div>
<div class="section level2">
<h2 id="figure-3">Figure 3<a class="anchor" aria-label="anchor" href="#figure-3"></a>
</h2>
<p>Because Figure 3 is plotting a hypothetical infection burden to
demonstrate the role of state-differing ascertainment, we do not need to
load the previous simulations.</p>
<p>First, the heatmap is produced like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">I_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">200</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>  <span class="co"># Sequence of I values</span></span>
<span><span class="va">I_over_N_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>  <span class="co"># Sequence of I/N values</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">0.7</span>  <span class="co"># scaling the percentage</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">150</span>  <span class="co"># Scaling the number of infected</span></span>
<span></span>
<span><span class="co"># Generate data</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>I <span class="op">=</span> <span class="va">I_values</span>, I_over_N <span class="op">=</span> <span class="va">I_over_N_values</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">I</span> <span class="op">/</span> <span class="va">data</span><span class="op">$</span><span class="va">I_over_N</span>  <span class="co"># Calculate N</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">f</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">I</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">data</span><span class="op">$</span><span class="va">N</span><span class="op">)</span><span class="op">^</span><span class="fl">0.95</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">I</span><span class="op">/</span><span class="va">y</span><span class="op">)</span>  <span class="co"># Calculate f</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">data</span><span class="op">$</span><span class="va">f</span><span class="op">)</span>  <span class="co"># Calculate 1 - exp(-f)</span></span>
<span></span>
<span><span class="co"># Create the heatmap with a custom color scale</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">I</span>, y <span class="op">=</span> <span class="va">I_over_N</span>, fill <span class="op">=</span> <span class="va">z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deepskyblue3"</span>, <span class="st">"yellow"</span>, <span class="st">"firebrick"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.49</span>, <span class="fl">0.5</span>, <span class="fl">0.51</span>, <span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Baseline probability that a herd reports an outbreak"</span>, x <span class="op">=</span> <span class="st">"Infected Cattle (I)"</span>, y <span class="op">=</span> <span class="st">"Proportion of herd infected (I / N)"</span>, fill <span class="op">=</span> <span class="st">"Prob. report"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Remove x-axis gap</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Remove y-axis gap</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting-model_files/figure-html/unnamed-chunk-9-1.png" width="750">
Next, we produce the data for panels B and C:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many samples to use for this plot:</span></span>
<span><span class="va">asc_draws</span> <span class="op">&lt;-</span> <span class="fl">1000</span> </span>
<span><span class="co"># And what proportion do we assume is infected.</span></span>
<span><span class="va">infected_prop</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="co"># Use the ascertainment rate posterior</span></span>
<span><span class="co"># Load the posterior samples first</span></span>
<span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_posterior_fits.rds"</span>, package <span class="op">=</span> <span class="st">"cowflu"</span><span class="op">)</span></span>
<span><span class="co"># Load the .rds file</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></span>
<span><span class="va">asc_rate_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">samples</span><span class="op">$</span><span class="va">pars</span><span class="op">[</span><span class="fl">5</span>, ,<span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>State <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span>,</span>
<span>                      declare_prob_mid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">48</span><span class="op">)</span>,</span>
<span>                      declare_prob_lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">48</span><span class="op">)</span>,</span>
<span>                      declare_prob_upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">48</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">index_start</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">region_start</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="va">index_end</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">region_start</span><span class="op">[</span><span class="va">i</span><span class="op">+</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">n_herds</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">total_cows</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_cows_per_herd</span><span class="op">[</span><span class="va">index_start</span><span class="op">:</span><span class="va">index_end</span><span class="op">]</span></span>
<span>  <span class="va">mid_hold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">asc_draws</span><span class="op">)</span> <span class="op">)</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">asc_draws</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">infected_cows</span> <span class="op">&lt;-</span> <span class="va">total_cows</span><span class="op">*</span><span class="va">infected_prop</span></span>
<span>    <span class="va">prob_of_declaring</span> <span class="op">&lt;-</span> <span class="va">infected_cows</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="va">total_cows</span><span class="op">)</span><span class="op">^</span><span class="fl">0.95</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">infected_cows</span><span class="op">/</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="va">prob_of_declaring</span> <span class="op">&lt;-</span> <span class="va">prob_of_declaring</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">asc_rate_samples</span>, <span class="fl">1</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">prob_of_declaring</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">prob_of_declaring</span><span class="op">)</span></span>
<span>    <span class="va">mid_hold</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">prob_of_declaring</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">p2_data</span><span class="op">$</span><span class="va">declare_prob_mid</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mid_hold</span><span class="op">)</span></span>
<span>  <span class="va">p2_data</span><span class="op">$</span><span class="va">declare_prob_lower</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mid_hold</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">p2_data</span><span class="op">$</span><span class="va">declare_prob_upper</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">mid_hold</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now we can plot the midpoints as a map:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">maps</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.1, GDAL 3.8.4, PROJ 9.4.0; sf_use_s2() is TRUE</span></span>
<span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span></span>
<span><span class="co"># Get the coordinates of the outbreak state</span></span>
<span><span class="va">state_coords</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">long</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Load US states map data</span></span>
<span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"state"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Prepare state names to match the data, assuming Prob_df has state names in all caps</span></span>
<span><span class="va">us_states</span><span class="op">$</span><span class="va">State</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">us_states</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge probability data with the map data</span></span>
<span><span class="va">map_data</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">p2_data</span>, by <span class="op">=</span> <span class="st">"State"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">map_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>  ,     <span class="st">"State"</span>  ,  <span class="st">"prob_mid"</span>  ,   <span class="st">"prob_lower"</span>, <span class="st">"prob_upper"</span>, <span class="st">"geom"</span>   <span class="op">)</span></span>
<span></span>
<span><span class="va">map_data</span> <span class="op">&lt;-</span> <span class="va">map_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">state_coords</span>, by <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Create ggplot map</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">map_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">prob_mid</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>      colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"darkgoldenrod1"</span>, <span class="st">"darkolivegreen"</span><span class="op">)</span>,  <span class="co"># Colors for the gradient</span></span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Corresponding values for the colors</span></span>
<span>      limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Probability"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"State Average Probability of Reporting an Outbreak, Assuming %s%% of All Cattle Are Infected."</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">infected_prop</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         <span class="co">#subtitle = "95% Confidence Intervals Shown",</span></span>
<span>         x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co"># Remove axis labels</span></span>
<span>          axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting-model_files/figure-html/unnamed-chunk-11-1.png" width="750"></p>
<p>And lastly output the 95% CrIs for each state as a forest plot:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Capitalize region:</span></span>
<span>  <span class="va">map_data</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu">capitalize</span><span class="op">(</span><span class="va">map_data</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span>  <span class="co">## Also get two letter shorthand</span></span>
<span>  <span class="va">map_data</span><span class="op">$</span><span class="va">shorthand</span> <span class="op">&lt;-</span> <span class="va">state.abb</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">map_data</span><span class="op">$</span><span class="va">region</span>, <span class="va">state.name</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="co"># Step 1: Order data by mean (descending)</span></span>
<span>  <span class="va">map_data</span> <span class="op">&lt;-</span> <span class="va">map_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">prob_mid</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>shorthand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">shorthand</span>, levels <span class="op">=</span> <span class="va">shorthand</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Reorder factor levels</span></span>
<span></span>
<span>  <span class="co"># Step 2: Create the forest plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">map_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">shorthand</span>, y <span class="op">=</span> <span class="va">prob_mid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html" class="external-link">geom_errorbar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">prob_lower</span>, ymax <span class="op">=</span> <span class="va">prob_upper</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">0.2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Error bars</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span>, color <span class="op">=</span> <span class="st">"darkgoldenrod3"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Plot mean as points</span></span>
<span>    <span class="co">#coord_flip() +  # Flip axes for a horizontal forest plot</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Probability of Reporting an Outbreak, Assuming %s%% of Cattle are Infected"</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">infected_prop</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      x <span class="op">=</span> <span class="st">"US State"</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Probability of Declaring Outbreak"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_x_discrete</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>n.dodge <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting-model_files/figure-html/unnamed-chunk-12-1.png" width="750"></p>
</div>
<div class="section level2">
<h2 id="figure-4">Figure 4<a class="anchor" aria-label="anchor" href="#figure-4"></a>
</h2>
<p>Figure 4 captures the probability of exported cattle testing positive
for H5N1 at the state border.</p>
<p>First, we calculate and prepare the data in a dataframe:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Prob_data</span> <span class="op">&lt;-</span> <span class="va">Sim_results</span><span class="op">[</span>,<span class="fl">97</span><span class="op">:</span><span class="fl">144</span>,<span class="op">]</span></span>
<span><span class="va">n_timepoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Prob_data</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">## Make a master data_frame:</span></span>
<span><span class="va">Prob_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>State <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">US_States</span>, <span class="va">n_timepoints</span><span class="op">)</span>,</span>
<span>                      Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">50</span>, each <span class="op">=</span> <span class="fl">48</span><span class="op">)</span>,</span>
<span>                      mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">48</span><span class="op">*</span><span class="va">n_timepoints</span><span class="op">)</span>,</span>
<span>                      lower_ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">48</span><span class="op">*</span><span class="va">n_timepoints</span><span class="op">)</span>,</span>
<span>                      upper_ci <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">48</span><span class="op">*</span><span class="va">n_timepoints</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Populate the dataframe:</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_timepoints</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Prob_df</span><span class="op">$</span><span class="va">mean</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">48</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">Prob_data</span><span class="op">[</span>,,<span class="va">i</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">mean</span><span class="op">)</span></span>
<span>  <span class="va">Prob_df</span><span class="op">$</span><span class="va">lower_ci</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">48</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">Prob_data</span><span class="op">[</span>,,<span class="va">i</span><span class="op">]</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.025</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Prob_df</span><span class="op">$</span><span class="va">upper_ci</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="fl">48</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">Prob_data</span><span class="op">[</span>,,<span class="va">i</span><span class="op">]</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##Fix floating point precision issue:</span></span>
<span><span class="va">Prob_df</span><span class="op">$</span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">Prob_df</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span>  <span class="co"># Cap at 1</span></span>
<span><span class="va">Prob_df</span><span class="op">$</span><span class="va">lower_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">Prob_df</span><span class="op">$</span><span class="va">lower_ci</span><span class="op">)</span>  <span class="co"># Cap at 1</span></span>
<span><span class="va">Prob_df</span><span class="op">$</span><span class="va">upper_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">Prob_df</span><span class="op">$</span><span class="va">upper_ci</span><span class="op">)</span>  <span class="co"># Cap at 1</span></span>
<span></span>
<span><span class="co">## Convert from "probability of passing test", to, "probability of a positive test at state border"</span></span>
<span><span class="va">Prob_df</span><span class="op">$</span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">Prob_df</span><span class="op">$</span><span class="va">mean</span></span>
<span><span class="va">Prob_df</span><span class="op">$</span><span class="va">lower_ci</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">Prob_df</span><span class="op">$</span><span class="va">lower_ci</span></span>
<span><span class="va">Prob_df</span><span class="op">$</span><span class="va">upper_ci</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">Prob_df</span><span class="op">$</span><span class="va">upper_ci</span></span></code></pre></div>
<p>Then, decide which week you want to output, filter the data, and plot
the probability on a US map:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Which week to plot?</span></span>
<span><span class="va">timepoint</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span></span>
<span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span></span>
<span><span class="co"># Get the coordinates of the outbreak state</span></span>
<span><span class="va">state_coords</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span>, long <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">long</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Load US states map data</span></span>
<span><span class="va">us_states</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu">maps</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/maps/man/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"state"</span>, plot <span class="op">=</span> <span class="cn">FALSE</span>, fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Prepare state names to match the data, assuming Prob_df has state names in all caps</span></span>
<span><span class="va">us_states</span><span class="op">$</span><span class="va">State</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">toupper</a></span><span class="op">(</span><span class="va">us_states</span><span class="op">$</span><span class="va">ID</span><span class="op">)</span></span>
<span></span>
<span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-12-18"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Calculate w/b date</span></span>
<span>  <span class="va">Week_Beginning</span> <span class="op">&lt;-</span> <span class="va">start_date</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">weeks</a></span><span class="op">(</span><span class="va">timepoint</span><span class="op">)</span></span>
<span>  <span class="va">Week_Beginning</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">Week_Beginning</span>, <span class="st">"%d/%m/%Y"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Week_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Prob_df</span>, <span class="va">Week</span> <span class="op">==</span> <span class="va">timepoint</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Merge probability data with the map data</span></span>
<span>  <span class="va">map_data</span> <span class="op">&lt;-</span> <span class="va">us_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">Week_data</span>, by <span class="op">=</span> <span class="st">"State"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">map_data</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"region"</span>  ,     <span class="st">"State"</span>  , <span class="st">"Week"</span>,  <span class="st">"mean"</span>  ,   <span class="st">"lower_ci"</span>, <span class="st">"upper_ci"</span>, <span class="st">"geom"</span>   <span class="op">)</span></span>
<span></span>
<span>  <span class="va">map_data</span> <span class="op">&lt;-</span> <span class="va">map_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">state_coords</span>, by <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">map_data</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co">##smaller scale</span></span>
<span>    <span class="co"># Create ggplot map</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">map_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>        colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"coral2"</span><span class="op">)</span>,  <span class="co"># Colors for the gradient</span></span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Corresponding values for the colors</span></span>
<span>        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"Mean \nProbability"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Mean Probability of H5N1 Positive Test When Exporting From State \n    Week Beginning %s"</span>, <span class="va">Week_Beginning</span><span class="op">)</span>,</span>
<span>           x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co"># Remove axis labels</span></span>
<span>            axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="co">##larger scale</span></span>
<span>    <span class="co"># Create ggplot map</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">map_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradientn</a></span><span class="op">(</span></span>
<span>        colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"coral2"</span>, <span class="st">"darkslategrey"</span><span class="op">)</span>,  <span class="co"># Colors for the gradient</span></span>
<span>        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span>,  <span class="co"># Corresponding values for the colors</span></span>
<span>        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        name <span class="op">=</span> <span class="st">"Mean \nProbability"</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Mean Probability of H5N1 Positive Test When Exporting From State \n    Week Beginning %s"</span>, <span class="va">Week_Beginning</span><span class="op">)</span>,</span>
<span>           x <span class="op">=</span> <span class="st">"Longitude"</span>, y <span class="op">=</span> <span class="st">"Latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,  <span class="co"># Remove axis labels</span></span>
<span>            axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span></code></pre></div>
<p><img src="plotting-model_files/figure-html/unnamed-chunk-14-1.png" width="750"></p>
</div>
<div class="section level2">
<h2 id="figure-5">Figure 5<a class="anchor" aria-label="anchor" href="#figure-5"></a>
</h2>
<p>Finally, Figure 5 explores the counterfactual scenarios of different
border testing start times and numbers of cows tested. To do this, we
have to run simulations like from the previous vignette, for different
choices of <code>n_test</code> and <code>time_test</code> parameters.
The actual manuscript figure uses 20,000 simulations of each scenario.
The below code only runs 50 for illustrative purposes.</p>
<p>First generate all the simulation data, and save it all in a
dataframe.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many simulation steps to calculate?</span></span>
<span><span class="va">sim_samples</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="co">## Load posteriors:</span></span>
<span><span class="va">file_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_posterior_fits.rds"</span>, package <span class="op">=</span> <span class="st">"cowflu"</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="va">file_path</span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">$</span><span class="va">pars</span></span>
<span><span class="co">## Collapse chains together:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">##We can't use all of them, so sample from the number of times we want to sim the model:</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="va">samples</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">sim_samples</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Pre-allocate arrays:</span></span>
<span><span class="va">Realtime_infected_factual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Confirmed_outbreaks_factual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">True_infected_herds_factual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Total_infected_cattle_factual</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">## Sample the model:</span></span>
<span>  <span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_inputs</span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span>, beta <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">]</span>, gamma <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">3</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                                 sigma <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">4</span>,<span class="va">i</span><span class="op">]</span>, asc_rate <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">5</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                                 dispersion <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_fixed_inputs</span><span class="op">(</span>p_region_export <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">p_region_export</span>,</span>
<span>                                                              p_cow_export <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">p_cow_export</span>,</span>
<span>                                                              movement_matrix <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">movement_matrix</span>,</span>
<span>                                                              time_test <span class="op">=</span> <span class="fl">19</span>,</span>
<span>                                                              n_herds_per_region <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span>,</span>
<span>                                                              n_cows_per_herd <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_cows_per_herd</span>,</span>
<span>                                                              start_herd <span class="op">=</span> <span class="fl">26940</span>, <span class="co">#26804 is where Texas starts.</span></span>
<span>                                                              start_count <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                                              condition_on_export <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                                 <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_create.html" class="external-link">dust_system_create</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cows</span><span class="op">(</span><span class="op">)</span>, <span class="va">pars</span>, n_particles <span class="op">=</span> <span class="fl">1</span>, dt <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_set_state_initial.html" class="external-link">dust_system_set_state_initial</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span> <span class="co">#This is the S_region outputs</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">index</span>, <span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="st">"+"</span><span class="op">)</span><span class="op">)</span> <span class="co">#*0:3 will get the SEIR, but 0:4 will also include the number of outbreaks</span></span>
<span>  <span class="co">##Also want the "true" # of infected herds, so add a number of regions on the end again.</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">index</span>, <span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">48</span> <span class="op">)</span></span>
<span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_simulate.html" class="external-link">dust_system_simulate</a></span><span class="op">(</span><span class="va">sys</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">50</span>, <span class="va">index</span><span class="op">)</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fl">6</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## Sum over dim 1, we only want national totals:</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">s2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>  <span class="co">##Fill the vectors:</span></span>
<span>  <span class="va">Realtime_infected_factual</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">3</span> ,<span class="op">]</span></span>
<span>  <span class="va">Confirmed_outbreaks_factual</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">5</span> ,<span class="op">]</span></span>
<span>  <span class="va">True_infected_herds_factual</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">6</span> ,<span class="op">]</span></span>
<span>  <span class="co">## To calculate cumulative infections, we take the number of recovered, and add the current infected</span></span>
<span>  <span class="va">Total_infected_cattle_factual</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">s2</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span> <span class="op">+</span> <span class="va">s2</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##Save the plot quantiles from these vectors:</span></span>
<span><span class="va">Weeks</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Total_infected_cattle_factual</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">Factual_data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Factual_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Factual_data3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Factual_data4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Populate the data frame:</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Factual_data1</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Currently_infected_cattle"</span></span>
<span>  <span class="va">Factual_data1</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Factual_data1</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Realtime_infected_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data1</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Realtime_infected_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data1</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Realtime_infected_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Factual_data2</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Total_infected_cattle"</span></span>
<span>  <span class="va">Factual_data2</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Factual_data2</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Total_infected_cattle_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data2</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Total_infected_cattle_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data2</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Total_infected_cattle_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Factual_data3</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Declared_outbreaks"</span></span>
<span>  <span class="va">Factual_data3</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Factual_data3</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data3</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data3</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Factual_data4</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"True_infected_herds"</span></span>
<span>  <span class="va">Factual_data4</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Factual_data4</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">True_infected_herds_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data4</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">True_infected_herds_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Factual_data4</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">True_infected_herds_factual</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="va">Factual_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Factual_data1</span>, <span class="va">Factual_data2</span>, <span class="va">Factual_data3</span>, <span class="va">Factual_data4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">Factual_data1</span>, <span class="va">Factual_data2</span>, <span class="va">Factual_data3</span>, <span class="va">Factual_data4</span>,</span>
<span>   <span class="va">Total_infected_cattle_factual</span>, <span class="va">Realtime_infected_factual</span>, <span class="va">True_infected_herds_factual</span>, <span class="va">Confirmed_outbreaks_factual</span><span class="op">)</span></span>
<span><span class="va">Factual_data</span><span class="op">$</span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="st">"Factual"</span></span>
<span></span>
<span><span class="co">####################</span></span>
<span><span class="co">#Do it again for Counterfactual 1 - The scenario with NO interventions</span></span>
<span><span class="co">#Pre-allocate arrays:</span></span>
<span><span class="va">Realtime_infected_counterfactual1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Confirmed_outbreaks_counterfactual1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">True_infected_herds_counterfactual1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Total_infected_cattle_counterfactual1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">## Sample the model:</span></span>
<span>  <span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_inputs</span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span>, beta <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">]</span>, gamma <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">3</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                                 sigma <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">4</span>,<span class="va">i</span><span class="op">]</span>, asc_rate <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">5</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                                 dispersion <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_fixed_inputs</span><span class="op">(</span>p_region_export <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">p_region_export</span>,</span>
<span>                                                              p_cow_export <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">p_cow_export</span>,</span>
<span>                                                              movement_matrix <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">movement_matrix</span>,</span>
<span>                                                              time_test <span class="op">=</span> <span class="fl">190000</span>,</span>
<span>                                                              n_herds_per_region <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span>,</span>
<span>                                                              n_cows_per_herd <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_cows_per_herd</span>,</span>
<span>                                                              start_herd <span class="op">=</span> <span class="fl">26940</span>, <span class="co">#26804 is where Texas starts.</span></span>
<span>                                                              start_count <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                                              condition_on_export <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                                 <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_create.html" class="external-link">dust_system_create</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cows</span><span class="op">(</span><span class="op">)</span>, <span class="va">pars</span>, n_particles <span class="op">=</span> <span class="fl">1</span>, dt <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_set_state_initial.html" class="external-link">dust_system_set_state_initial</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span> <span class="co">#This is the S_region outputs</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">index</span>, <span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="st">"+"</span><span class="op">)</span><span class="op">)</span> <span class="co">#*0:3 will get the SEIR, but 0:4 will also include the number of outbreaks</span></span>
<span>  <span class="co">##Also want the "true" # of infected herds, so add a number of regions on the end again.</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">index</span>, <span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">48</span> <span class="op">)</span></span>
<span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_simulate.html" class="external-link">dust_system_simulate</a></span><span class="op">(</span><span class="va">sys</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">50</span>, <span class="va">index</span><span class="op">)</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fl">6</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## Sum over dim 1, we only want national totals:</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">s2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>  <span class="co">##Fill the vectors:</span></span>
<span>  <span class="va">Realtime_infected_counterfactual1</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">3</span> ,<span class="op">]</span></span>
<span>  <span class="va">Confirmed_outbreaks_counterfactual1</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">5</span> ,<span class="op">]</span></span>
<span>  <span class="va">True_infected_herds_counterfactual1</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">6</span> ,<span class="op">]</span></span>
<span>  <span class="co">## To calculate cumulative infections, we take the number of recovered, and add the current infected</span></span>
<span>  <span class="va">Total_infected_cattle_counterfactual1</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">s2</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span> <span class="op">+</span> <span class="va">s2</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##Save the plot quantiles from these vectors:</span></span>
<span><span class="va">Weeks</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual1</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">Counterfactual1_data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Counterfactual1_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Counterfactual1_data3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Counterfactual1_data4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Populate the data frame:</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Counterfactual1_data1</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Currently_infected_cattle"</span></span>
<span>  <span class="va">Counterfactual1_data1</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual1_data1</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Realtime_infected_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data1</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Realtime_infected_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data1</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Realtime_infected_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Counterfactual1_data2</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Total_infected_cattle"</span></span>
<span>  <span class="va">Counterfactual1_data2</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual1_data2</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data2</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data2</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Counterfactual1_data3</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Declared_outbreaks"</span></span>
<span>  <span class="va">Counterfactual1_data3</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual1_data3</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data3</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data3</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Counterfactual1_data4</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"True_infected_herds"</span></span>
<span>  <span class="va">Counterfactual1_data4</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual1_data4</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">True_infected_herds_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data4</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">True_infected_herds_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual1_data4</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">True_infected_herds_counterfactual1</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="va">Counterfactual1_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Counterfactual1_data1</span>, <span class="va">Counterfactual1_data2</span>, <span class="va">Counterfactual1_data3</span>, <span class="va">Counterfactual1_data4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Stick the two together</span></span>
<span><span class="va">Factual_data</span><span class="op">$</span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="st">"True measures"</span></span>
<span><span class="va">Counterfactual1_data</span><span class="op">$</span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="st">"Counterfactual 1 -\n No measures"</span></span>
<span></span>
<span><span class="va">Plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Factual_data</span>, <span class="va">Counterfactual1_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co">###########################</span></span>
<span><span class="co">#Do it again for Counterfactual 2 - STRONGER interventions</span></span>
<span><span class="co">#test up to 100 cows, and start it week 15 (a month earlier)</span></span>
<span><span class="co">#Pre-allocate arrays:</span></span>
<span><span class="va">Realtime_infected_counterfactual2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Confirmed_outbreaks_counterfactual2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">True_infected_herds_counterfactual2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Total_infected_cattle_counterfactual2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co">## Sample the model:</span></span>
<span>  <span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_inputs</span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">1</span>,<span class="va">i</span><span class="op">]</span>, beta <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">2</span>,<span class="va">i</span><span class="op">]</span>, gamma <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">3</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                                 sigma <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">4</span>,<span class="va">i</span><span class="op">]</span>, asc_rate <span class="op">=</span> <span class="va">samples</span><span class="op">[</span><span class="fl">5</span>,<span class="va">i</span><span class="op">]</span>,</span>
<span>                                 dispersion <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                 <span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cowflu_fixed_inputs</span><span class="op">(</span>p_region_export <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">p_region_export</span>,</span>
<span>                                                              p_cow_export <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">p_cow_export</span>,</span>
<span>                                                              movement_matrix <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">movement</span><span class="op">$</span><span class="va">movement_matrix</span>,</span>
<span>                                                              time_test <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                                                              n_test <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                                              n_herds_per_region <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_herds_per_region</span>,</span>
<span>                                                              n_cows_per_herd <span class="op">=</span> <span class="fu">cowflu</span><span class="fu">:::</span><span class="va">usda_data</span><span class="op">$</span><span class="va">n_cows_per_herd</span>,</span>
<span>                                                              start_herd <span class="op">=</span> <span class="fl">26940</span>, <span class="co">#26804 is where Texas starts.</span></span>
<span>                                                              start_count <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                                              condition_on_export <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>                                 <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span>  <span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_create.html" class="external-link">dust_system_create</a></span><span class="op">(</span><span class="fu">cowflu</span><span class="fu">:::</span><span class="fu">cows</span><span class="op">(</span><span class="op">)</span>, <span class="va">pars</span>, n_particles <span class="op">=</span> <span class="fl">1</span>, dt <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_set_state_initial.html" class="external-link">dust_system_set_state_initial</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq.int</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="fl">1</span>, length.out <span class="op">=</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span> <span class="co">#This is the S_region outputs</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span><span class="va">index</span>, <span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_herds</span> <span class="op">+</span> <span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>, <span class="st">"+"</span><span class="op">)</span><span class="op">)</span> <span class="co">#*0:3 will get the SEIR, but 0:4 will also include the number of outbreaks</span></span>
<span>  <span class="co">##Also want the "true" # of infected herds, so add a number of regions on the end again.</span></span>
<span>  <span class="va">index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">index</span>, <span class="va">index</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">index</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">48</span> <span class="op">)</span></span>
<span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="fu">dust2</span><span class="fu">::</span><span class="fu"><a href="https://mrc-ide.github.io/dust2/reference/dust_system_simulate.html" class="external-link">dust_system_simulate</a></span><span class="op">(</span><span class="va">sys</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">50</span>, <span class="va">index</span><span class="op">)</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="va">s</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pars</span><span class="op">$</span><span class="va">n_regions</span>, <span class="fl">6</span>, <span class="fl">51</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## Sum over dim 1, we only want national totals:</span></span>
<span>  <span class="va">s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">s2</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>  <span class="co">##Fill the vectors:</span></span>
<span>  <span class="va">Realtime_infected_counterfactual2</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">3</span> ,<span class="op">]</span></span>
<span>  <span class="va">Confirmed_outbreaks_counterfactual2</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">5</span> ,<span class="op">]</span></span>
<span>  <span class="va">True_infected_herds_counterfactual2</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span>  <span class="va">s2</span><span class="op">[</span><span class="fl">6</span> ,<span class="op">]</span></span>
<span>  <span class="co">## To calculate cumulative infections, we take the number of recovered, and add the current infected</span></span>
<span>  <span class="va">Total_infected_cattle_counterfactual2</span><span class="op">[</span><span class="va">i</span>,<span class="op">]</span> <span class="op">&lt;-</span> <span class="va">s2</span><span class="op">[</span><span class="fl">4</span>, <span class="op">]</span> <span class="op">+</span> <span class="va">s2</span><span class="op">[</span><span class="fl">3</span>,<span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">##Save the plot quantiles from these vectors:</span></span>
<span><span class="va">Weeks</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual2</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">Counterfactual2_data1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Counterfactual2_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Counterfactual2_data3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Counterfactual2_data4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    Week <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    mean_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    lower_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                    upper_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## Populate the data frame:</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Weeks</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">Counterfactual2_data1</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Currently_infected_cattle"</span></span>
<span>  <span class="va">Counterfactual2_data1</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual2_data1</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Realtime_infected_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data1</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Realtime_infected_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data1</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Realtime_infected_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Counterfactual2_data2</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Total_infected_cattle"</span></span>
<span>  <span class="va">Counterfactual2_data2</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual2_data2</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data2</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data2</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Total_infected_cattle_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Counterfactual2_data3</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Declared_outbreaks"</span></span>
<span>  <span class="va">Counterfactual2_data3</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual2_data3</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data3</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data3</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">Confirmed_outbreaks_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">Counterfactual2_data4</span><span class="op">$</span><span class="va">metric</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"True_infected_herds"</span></span>
<span>  <span class="va">Counterfactual2_data4</span><span class="op">$</span><span class="va">Week</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">Weeks</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">Counterfactual2_data4</span><span class="op">$</span><span class="va">mean_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">True_infected_herds_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data4</span><span class="op">$</span><span class="va">lower_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">True_infected_herds_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.025</span><span class="op">)</span></span>
<span>  <span class="va">Counterfactual2_data4</span><span class="op">$</span><span class="va">upper_value</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">True_infected_herds_counterfactual2</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, <span class="fl">0.975</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span><span class="va">Counterfactual2_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Counterfactual2_data1</span>, <span class="va">Counterfactual2_data2</span>, <span class="va">Counterfactual2_data3</span>, <span class="va">Counterfactual2_data4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Stick the two together</span></span>
<span><span class="va">Counterfactual2_data</span><span class="op">$</span><span class="va">scenario</span> <span class="op">&lt;-</span> <span class="st">"Counterfactual 2 -\n Stronger measures"</span></span>
<span></span>
<span><span class="va">Plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">Plot_data</span>, <span class="va">Counterfactual2_data</span><span class="op">)</span></span></code></pre></div>
<p>And now, we can plot the outputs of interest like so:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-12-18"</span><span class="op">)</span></span>
<span><span class="co"># Add the Week_Beginning column to the data frame</span></span>
<span><span class="va">Plot_data</span><span class="op">$</span><span class="va">Week_Beginning</span> <span class="op">&lt;-</span> <span class="va">start_date</span> <span class="op">+</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">weeks</a></span><span class="op">(</span><span class="va">Plot_data</span><span class="op">$</span><span class="va">Week</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Declared outbreaks</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Plot_data</span>, <span class="va">metric</span> <span class="op">==</span> <span class="st">"Declared_outbreaks"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Week_Beginning</span>, y <span class="op">=</span> <span class="va">mean_value</span>, colour <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">Week_Beginning</span>, ymin <span class="op">=</span> <span class="va">lower_value</span>, ymax <span class="op">=</span> <span class="va">upper_value</span>, fill <span class="op">=</span> <span class="va">scenario</span><span class="op">)</span>,</span>
<span>              alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Reported Outbreaks"</span>, title <span class="op">=</span> <span class="st">"Weekly National Reported Outbreaks"</span>,</span>
<span>       color <span class="op">=</span> <span class="st">"Scenario"</span>, fill <span class="op">=</span> <span class="st">"Scenario"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"white"</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,    <span class="co"># Title font size</span></span>
<span>    axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,  <span class="co"># X-axis title font size</span></span>
<span>    axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,  <span class="co"># Y-axis title font size</span></span>
<span>    axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,   <span class="co"># X-axis labels font size</span></span>
<span>    axis.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,   <span class="co"># Y-axis labels font size</span></span>
<span>    legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span>,   <span class="co"># Legend text font size</span></span>
<span>    legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span>,  <span class="co"># Legend title font size</span></span>
<span>    legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.6</span><span class="op">)</span>, <span class="co"># Adjust to place legend inside the plot area</span></span>
<span>    legend.key.spacing.y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="st">'cm'</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"True measures"</span> <span class="op">=</span> <span class="st">"#362DD2"</span>,</span>
<span>    <span class="st">"Counterfactual 1 -\n No measures"</span> <span class="op">=</span> <span class="st">"#D2362D"</span>,</span>
<span>    <span class="st">"Counterfactual 2 -\n Stronger measures"</span> <span class="op">=</span> <span class="st">"#2DD236"</span></span>
<span>  <span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"True measures"</span> <span class="op">=</span> <span class="st">"#362DD2"</span>,</span>
<span>    <span class="st">"Counterfactual 1 -\n No measures"</span> <span class="op">=</span> <span class="st">"#D2362D"</span>,</span>
<span>    <span class="st">"Counterfactual 2 -\n Stronger measures"</span> <span class="op">=</span> <span class="st">"#2DD236"</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="plotting-model_files/figure-html/unnamed-chunk-16-1.png" width="750"></p>
<p>Other outputs can be produced by selecting a different filter option
for <code>metric</code> in the first line of the <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>
function.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thomas Rawson, Rich FitzJohn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
